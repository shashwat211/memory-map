<!DOCTYPE html>
<html>
<head>
    <title>Happy Birthday Shashwat! üéâ</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Loading Screen */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }
        .loading-content {
            text-align: center;
            color: white;
        }
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            font-family: 'Poppins', sans-serif;
            font-size: 18px;
            margin-bottom: 10px;
        }
        .loading-subtext {
            font-family: 'Dancing Script', cursive;
            font-size: 24px;
            opacity: 0.8;
        }

        /* Enhanced Background */
        html { 
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%),
                linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            min-height: 100vh;
        }
        body { 
            margin: 0; 
            padding: 0; 
            font-family: 'Poppins', sans-serif; 
            overflow: hidden;
            position: relative;
        }

        /* Floating particles */
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            pointer-events: none;
            animation: float-particle 6s ease-in-out infinite;
        }
        @keyframes float-particle {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.1; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 0.3; }
        }
        
        /* MODERN BIRTHDAY HEADER (New Design) */
        .birthday-header {
            position: absolute;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 90%;
            max-width: 600px;
            pointer-events: none; /* Allow clicking through empty space */
        }

        .header-pill {
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 12px 30px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.8);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .header-pill:hover {
            transform: scale(1.02);
            background: rgba(255, 255, 255, 0.95);
        }

        .header-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 1.4rem;
            color: #2d3436;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .gradient-text {
            background: linear-gradient(135deg, #ff9a9e 0%, #a18cd1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Dancing Script', cursive;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .header-subtitle {
            font-size: 0.85rem;
            color: #636e72;
            margin-top: 2px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        
        /* Map Container */
        #map { 
            height: 100vh; 
            width: 100%; 
            position: relative;
        }

        /* Enhanced Popup Card */
        .custom-popup .leaflet-popup-content-wrapper {
            border-radius: 20px;
            padding: 0;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            border: 2px solid #ff9a9e;
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.95);
        }
        .custom-popup .leaflet-popup-content {
            margin: 0;
            width: 340px !important;
        }
        
        /* Style for the Photo inside the popup */
        .popup-photo {
            width: 100%;
            height: auto;
            min-height: 200px;
            max-height: 400px;
            object-fit: contain;
            display: block;
            border-bottom: 3px solid #fecfef;
            background: #f8f9fa;
            border-radius: 8px 8px 0 0;
        }

        /* Style for the Video inside the popup */
        .popup-video {
            width: 100%;
            height: auto;
            min-height: 200px;
            max-height: 400px;
            display: block;
            border-bottom: 3px solid #fecfef;
            border-radius: 8px 8px 0 0;
        }

        /* Style for the Text inside the popup */
        .popup-text-container {
            padding: 20px;
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
        }
        .popup-from {
            font-weight: 700;
            color: #ff6b6b;
            font-size: 16px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Dancing Script', cursive;
        }
        .popup-analogy {
            font-weight: 600;
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
            font-style: italic;
        }
        .popup-message {
            font-size: 14px;
            color: #555;
            line-height: 1.6;
            font-style: italic;
        }

        /* Style for the Birthday Marker */
        .birthday-marker {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            border: 3px solid #fff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .header-title { font-size: 1.1rem; }
            .gradient-text { font-size: 1.5rem; }
            .custom-popup .leaflet-popup-content { width: 280px !important; }
        }

        /* Tour Controls */
        .tour-controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 15px;
        }
        .tour-button {
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(255,154,158,0.3);
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.2);
        }
        .tour-button:hover {
            background: linear-gradient(135deg, #ff6b6b, #ff9a9e);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255,154,158,0.4);
        }
        .tour-button:active {
            transform: translateY(-1px);
        }
    </style>
</head>
<body>

    <div id="loading">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading Memories...</div>
            <div class="loading-subtext">Happy Birthday Shashwat! üéâ</div>
        </div>
    </div>

    <div class="birthday-header">
        <div class="header-pill">
            <div class="header-title">
                The Other Side of <span class="gradient-text">25</span>
            </div>
            <div class="header-subtitle">
                <i class="fas fa-plane"></i> Exploring memories around the world
            </div>
        </div>
    </div>

    <div class="tour-controls">
        <button id="start-tour" class="tour-button">üé¨ Start Story Tour</button>
        <button id="stop-tour" class="tour-button" style="display: none;">‚èπÔ∏è Stop Tour</button>
    </div>

    <div id="map"></div>

    <script>
        // --- STEP 1: INITIALIZE MAP ---
        var map = L.map('map', {
            zoomControl: true,
            scrollWheelZoom: true,
            center: [20, 0], // Default center
            zoom: 2
        });

        // --- STEP 2: LOAD MAP TILES ---
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            opacity: 0.4
        }).addTo(map);

        // --- STEP 3: YOUR DATA LIST ---
        var memories = [
            {
                lat: 47.2692, 
                lng: 11.4041, 
                name: "Meghna", 
                message: "Innsbruck where it was a double date (me, Krishnan, you & Shashwat), only that you & Shashwat didn't know it yet‚ù§Ô∏è", 
                photo: "Images/meghna.jpeg",
                icon: "ü•æ",
                order: 5
            },
            {
                lat: 48.1374, 
                lng: 11.5755, 
                name: "Krishnan", 
                message: "Together with Shashwat & Meghna we went to Marienplatz, Shashwat & Meghna did tresspassing into a closed restaurant and went into kids play area and started playing", 
                photo: "Images/krishnan.jpeg",
                icon: "üß∏",
                order: 4
            },
            {
                lat: 48.1495, 
                lng: 11.5780, 
                name: "Nikita", 
                message: "Munich, his house, his cooking, my appetite", 
                photo: "Images/nikita.jpeg",
                icon: "üë®‚Äçüç≥",
                order: 11
            },
            {
                lat: 48.1492, 
                lng: 11.5774, 
                name: "Shivani", 
                message: "Best memory I can't really define we always had a good time but what I really adore about him is: He's one of the kindest person I know and most accommodating one. He always made sure I never felt out of place whenever he was around", 
                photo: "Images/shivani.jpeg",
                icon: "üçÑ",
                order: 10
            },
            {
                lat: 48.1319, 
                lng: 11.6019, 
                name: "Aditi", 
                message: "I have so many fond memories with Shashwat, but one of my favourites stands out clearly. There was a birthday party on the beach, and I reached quite late. Everyone had brought something special, and by the time I arrived, I was extremely hungry. When Shashwat noticed me quietly looking around for food, he immediately came running and started making a plate just for me. He stayed by my side, making sure I ate properly and felt comfortable, not leaving until I was completely fed and felt good. That moment‚Äîhis kindness, and thoughtfulness‚Äîtruly touched my heart.", 
                photo: "Images/aditi.jpeg",
                icon: "üèä",
                order: 13
            },
            {
                lat: 48.2082, 
                lng: 16.3738, 
                name: "Diksha", 
                message: "I have memories with him in few countries by now but in Austria and Germany (munich) one are my favourite. Because in both places we have home ‚ù§Ô∏è This photo summerises one of the day 15th sep 2023, i was so drunk to remember anything. He made sure that I reach home safe, I drink enough. Its just one of them, he has forever been like my younger brother, I know whom I can rely on. Be it my wedding, my birthday, with taking care of my sister, with introducing me best people. He has been a blessing to me ‚ù§Ô∏è", 
                photo: "Images/diksha.jpeg",
                icon: "üç∫",
                order: 3
            },
            {
                lat: 9.9312, 
                lng: 76.2673, 
                name: "Saurabh", 
                message: "The most specific memory which cracks me up everytime is this: Where he used the \"Nada\" for tying up the shortsüòÇüòÇ", 
                photo: "Images/saurabh.jpeg",
                icon: "üòÇ",
                order: 16
            },
            {
                lat: 47.5622, 
                lng: 13.6493, 
                name: "Ann", 
                message: "thanks Shashwat for organising such a nice trip.", 
                photo: "Images/Ann.jpeg",
                icon: "üèîÔ∏è",
                order: 9
            },
            {
                lat: 64.1466, 
                lng: -21.9426, 
                name: "Srajit", 
                message: "Memories in Iceland and Portugal", 
                photo: "Images/srajit.jpeg",
                icon: "üßä",
                order: 6
            },
            {
                lat: 48.5734, 
                lng: 7.7521, 
                name: "Nancy", 
                message: "Hahaha..Strassburg....or the starry night with you both", 
                photo: "Images/nancy.jpeg",
                icon: "‚≠ê",
                order: 7
            },
            {
                lat: 41.1579, 
                lng: -8.6291, 
                name: "Vinit", 
                message: "The specific memory with Shashwat is from Porto when we were parking the car and there was no space üòÇ", 
                photo: "Images/vinit.jpeg",
                icon: "üöó",
                order: 8
            },
            {
                lat: 25.5358, 
                lng: 84.8511, 
                name: "Shreya", 
                message: "Our group spent days and night using this office space in the admin building, treating this as our party place, playing cards and ordering shakes and burgers from Batido, watching movies and having sleepovers. Courtesy of our TPC officer Shashwat MahajanüòÇ", 
                photo: "Images/shreya.jpeg",
                icon: "üë´",
                order: 1
            },
            {
                lat: 51.5074, 
                lng: -0.1278, 
                name: "Disha", 
                message: "instead of being younger one felt like I had older brother who cares for me alot ‚ù£Ô∏è", 
                photo: "Images/disha.jpeg",
                icon: "‚ú®",
                order: 14
            },
            {
                lat: 48.1439, 
                lng: 11.5475, 
                name: "Kara", 
                message: "Heylo, In the fitness studio when we learnt dancing", 
                photo: "Images/kara.jpeg",
                icon: "üíÉ",
                order: 15
            },
            {
                lat: 36.9741, 
                lng: -122.0308, 
                name: "Yun", 
                message: "I love our Santa cruz bonfire! Such good memory", 
                photo: "Images/yun.jpeg",
                icon: "üî•",
                order: 12
            },
            {
                lat: 25.6155, 
                lng: 85.1355, 
                name: "Hrishab", 
                message: "My memory with him on khada danda road", 
                photo: "Images/hrisabh.jpeg",
                video: "Images/hrisabh.mp4",
                icon: "üçï",
                order: 2
            },
        ];

        // --- STEP 4: GENERATE MARKERS ---
        // Sort memories by order
        memories.sort((a, b) => {
            const aOrder = a.order === undefined ? 999 : a.order;
            const bOrder = b.order === undefined ? 999 : b.order;
            return aOrder - bOrder;
        });
        
        var bounds = L.latLngBounds();
        var markers = []; // Store markers for tour
        
        memories.forEach(function(item, index) {
            
            // A. Create the Birthday Icon
            var birthdayIcon = L.divIcon({
                className: 'birthday-marker',
                html: item.icon,
                iconSize: [40, 40],
                iconAnchor: [20, 20]
            });

            // B. Create the Popup HTML
            var mediaContent = item.video ? 
                `<video class="popup-video" controls preload="metadata">
                    <source src="${item.video}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>` :
                `<img src="${item.photo}" class="popup-photo" alt="Memory">`;
            
            var popupContent = `
                <div>
                    ${mediaContent}
                    <div class="popup-text-container">
                        <div class="popup-from">üéÅ From ${item.name}</div>
                        ${item.analogy ? `<div class="popup-analogy">üß† Analogy: ${item.analogy}</div>` : ''}
                        <div class="popup-message">"${item.message}"</div>
                    </div>
                </div>
            `;

            // C. Add to Map
            var marker = L.marker([item.lat, item.lng], { icon: birthdayIcon })
                .addTo(map)
                .bindPopup(popupContent, {
                    className: 'custom-popup',
                    closeButton: false
                });
            
            bounds.extend([item.lat, item.lng]);
            markers.push(marker); // Store for tour
        });
        
        // --- STORY TOUR FUNCTIONALITY ---
        var currentTourIndex = 0;
        var isTourRunning = false;
        var tourTimeout; 

        function startStoryTour() {
            if (isTourRunning) return;
            isTourRunning = true;
            currentTourIndex = 0;
            
            document.getElementById('start-tour').style.display = 'none';
            document.getElementById('stop-tour').style.display = 'block';
            
            // Close any open popups
            map.closePopup();
            
            // Start the tour
            nextTourStop();
        }

        function stopStoryTour() {
            isTourRunning = false;
            clearTimeout(tourTimeout); 
            map.closePopup();
            
            document.getElementById('start-tour').style.display = 'block';
            document.getElementById('stop-tour').style.display = 'none';
            
            // Reset to full view
            map.fitBounds(bounds, {padding: [20, 20]});
        }

        function nextTourStop() {
            if (!isTourRunning) return;
            
            var marker = markers[currentTourIndex];
            var memory = memories[currentTourIndex];
            
            // Smooth fly animation to location
            map.flyTo([memory.lat, memory.lng], 8, {
                animate: true,
                duration: 2.5
            });
            
            // Open popup after animation completes
            tourTimeout = setTimeout(() => {
                if (isTourRunning) {
                    marker.openPopup();
                    
                    // Auto-play video if it's Hrishab's memory
                    if (memory.video) {
                        setTimeout(() => {
                            var videoElement = document.querySelector('.popup-video');
                            if (videoElement) {
                                videoElement.play().catch(e => {
                                    console.log('Video autoplay failed:', e);
                                });
                            }
                        }, 500);
                    }
                }
            }, 2500);
            
            // Move to next after display time
            var displayTime = memory.video ? 25000 : 8000;
            
            var totalWait = 2500 + displayTime;

            tourTimeout = setTimeout(() => {
                if (isTourRunning) {
                    map.closePopup();
                    currentTourIndex = (currentTourIndex + 1) % markers.length;
                    nextTourStop();
                }
            }, totalWait);
        }

        // Add event listeners
        document.getElementById('start-tour').addEventListener('click', startStoryTour);
        document.getElementById('stop-tour').addEventListener('click', stopStoryTour);

        // Create floating particles
        function createParticles() {
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + 'vw';
                    particle.style.top = Math.random() * 100 + 'vh';
                    particle.style.width = particle.style.height = (Math.random() * 6 + 2) + 'px';
                    particle.style.animationDelay = Math.random() * 6 + 's';
                    particle.style.animationDuration = (Math.random() * 4 + 6) + 's';
                    document.body.appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 10000);
                }, i * 200);
            }
        }

        // Initialize when map loads
        let loadingHidden = false;
        
        function hideLoadingScreen() {
            if (loadingHidden) return;
            loadingHidden = true;
            
            // Initial map fit
            map.fitBounds(bounds, {padding: [50, 50]});

            const loading = document.getElementById('loading');
            if (loading) {
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                }, 500);
            }
        }
        
        // Try to hide when map is ready
        map.whenReady(function() {
            setTimeout(hideLoadingScreen, 1000); 
        });
        
        // Start particle animation immediately
        createParticles();
        setInterval(createParticles, 8000);

    </script>
</body>
</html>